version: '3.9'

services:
  # -------------------------
  # Database Service (MySQL)
  # -------------------------
  paymybuddy-db:
    image: mysql:5.7
    container_name: paymybuddy-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword   # root password
      MYSQL_DATABASE: paymybuddy         # database name
      MYSQL_USER: paymybuddy_user        # database user
      MYSQL_PASSWORD: supersecret        # user password
    ports:
      - "3306:3306"
    volumes:
      - db-data:/var/lib/mysql           # persistent storage
      - ./initdb:/docker-entrypoint-initdb.d # initialize DB with scripts

  # -------------------------
  # Backend Service (Spring Boot)
  # -------------------------
  paymybuddy-backend:
    build: .
    container_name: paymybuddy-backend
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_USERNAME: paymybuddy_user
      SPRING_DATASOURCE_PASSWORD: supersecret
      SPRING_DATASOURCE_URL: jdbc:mysql://paymybuddy-db:3306/paymybuddy
    depends_on:
      - paymybuddy-db    # start DB first

# -------------------------
# Volumes persistants
# -------------------------
volumes:
  db-data:
